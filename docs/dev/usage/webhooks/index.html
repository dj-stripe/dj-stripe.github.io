<!DOCTYPE html><!--Lt0K8WUACoDZQxw3pAg8v--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/2ff57a8dc1dd022b.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/ce02c38972971c8a.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-08309892bbe354a2.js"/><script src="/_next/static/chunks/4bd1b696-cf72ae8a39fa05aa.js" async=""></script><script src="/_next/static/chunks/964-69097a61540f27b4.js" async=""></script><script src="/_next/static/chunks/main-app-b0c2b1956eab1d69.js" async=""></script><script src="/_next/static/chunks/app/layout-e2df609ea3d3ba96.js" async=""></script><script src="/_next/static/chunks/244-75f77586f1edfee3.js" async=""></script><script src="/_next/static/chunks/105-9c71a7be9e3657b0.js" async=""></script><script src="/_next/static/chunks/app/docs/%5Bversion%5D/%5B%5B...slug%5D%5D/page-3887ad97704d0fd7.js" async=""></script><meta name="next-size-adjust" content=""/><title>dj-stripe - Stripe Made Easy for Django Developers</title><meta name="description" content="The easiest way to integrate Stripe with your Django project. Handle payments, subscriptions, and webhooks with just a few lines of code."/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 antialiased"><div hidden=""><!--$--><!--/$--></div><div class="min-h-screen bg-white dark:bg-gray-900"><header class="border-b border-gray-200 dark:border-gray-800 sticky top-0 bg-white dark:bg-gray-900 z-10"><nav class="container mx-auto px-6 py-4 flex items-center justify-between"><a class="text-2xl font-bold" href="/">dj-<span class="text-stripe-blurple">stripe</span></a><div class="flex gap-6 items-center"><a class="hover:text-blue-600 transition-colors" href="/about/">About</a><a class="text-blue-600 font-semibold" href="/docs/latest/">Documentation</a><a class="hover:text-blue-600 transition-colors" href="/sponsors/">Sponsors</a><a class="hover:text-blue-600 transition-colors" href="/team/">Team</a><a class="hover:text-blue-600 transition-colors" href="/support/">Support</a><a href="https://github.com/dj-stripe/dj-stripe" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-700 dark:text-gray-300" target="_blank" rel="noopener noreferrer"><i class="fab fa-github text-xl"></i><div class="flex flex-col"><span class="text-sm font-medium">dj-stripe</span><div class="flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400"><span>Loading...</span></div></div></a><select class="px-3 py-1 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800"><option value="dev" selected="">vdev</option></select><div class="relative"><button class="flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><span>Search</span><kbd class="hidden sm:inline-block px-1.5 py-0.5 text-xs bg-gray-200 dark:bg-gray-700 rounded">âŒ˜K</kbd></button></div><button class="group relative p-2.5 rounded-full hover:bg-gray-100/80 dark:hover:bg-gray-800/80 transition-all duration-200 hover:scale-105 active:scale-95" aria-label="Switch to dark mode"><div class="absolute inset-0 rounded-full bg-gradient-to-br from-yellow-200/20 to-orange-300/20 dark:from-purple-400/20 dark:to-blue-500/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div><div class="relative transition-all duration-300 "><div class="relative w-5 h-5"><svg class="w-full h-full text-amber-500 transition-all duration-300 drop-shadow-sm" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4" class="animate-pulse"></circle><g class="animate-spin" style="transform-origin:12px 12px;animation-duration:8s"><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></g></svg></div></div><div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-2 py-1 text-xs text-white bg-gray-900 dark:bg-gray-700 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">Switch to <!-- -->dark<!-- --> mode</div></button></div></nav></header><div class="container mx-auto px-6 py-8"><div class="flex gap-8"><aside class="w-64 flex-shrink-0"><nav class="sticky top-24"><h3 class="font-semibold mb-4">Documentation</h3><ul class="space-y-2"><li><a class="block px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors " href="/docs/dev/">Getting Started</a><ul class="ml-4 mt-2 space-y-1"><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/installation/">Installation</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/api_keys/">API Keys</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/api_versions/">API Versions</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/upgrade_dj_stripe/">Upgrade Guide</a></li></ul></li><li><a class="block px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors " href="/docs/dev/usage/">Usage</a><ul class="ml-4 mt-2 space-y-1"><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors bg-blue-50 dark:bg-blue-900/20 text-blue-600" href="/docs/dev/usage/webhooks/">Webhooks</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/usage/subscribing_customers/">Subscribing Customers</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/usage/add_payment_method_to_customer/">Payment Methods</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/usage/managing_subscriptions/">Managing Subscriptions</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/usage/using_stripe_checkout/">Stripe Checkout</a></li><li><a class="block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400" href="/docs/dev/usage/manually_syncing_with_stripe/">Manual Syncing</a></li></ul></li></ul></nav></aside><main class="flex-1 max-w-4xl"><article class="prose prose-lg max-w-none"><h1>Using Stripe Webhooks</h1>
<h2>Setting up a new webhook endpoint in dj-stripe</h2>
<p>As of dj-stripe 2.7.0, dj-stripe can create its own webhook endpoints on Stripe from the
Django administration.</p>
<p>Create a new webhook endpoint from the Django administration by going to dj-stripe
-&gt; Webhook endpoints -&gt; Add webhook endpoint (or <code>/admin/djstripe/webhookendpoint/add/</code>).</p>
<p>From there, you can choose an account to create the endpoint for.
If no account is chosen, the default Stripe API key will be used to create the endpoint.
You can also choose to create the endpoint in test mode or live mode.</p>
<p>You may want to change the base URL of the endpoint. This field will be prefilled with
the current site. If you&#x27;re running on the local development server, you may see
<code>http://localhost:8000</code> or similar in there. Stripe won&#x27;t let you save webhook endpoints
with such a value, so you will want to change it to a real website URL.</p>
<p>When saved from the admin, the endpoint will be created in Stripe with a dj-stripe
specific UUID which will be part of the URL, making it impossible to guess externally
by brute-force.</p>
<h2>Extra configuration</h2>
<p>dj-stripe provides the following settings to tune how your webhooks work:</p>
<ul>
<li>[<code>DJSTRIPE_WEBHOOK_VALIDATION</code>][djstripe.settings.DjstripeSettings.WEBHOOK_VALIDATION]</li>
<li>[<code>DJSTRIPE_WEBHOOK_EVENT_CALLBACK</code>][djstripe.settings.DjstripeSettings.WEBHOOK_EVENT_CALLBACK]</li>
</ul>
<h2>Handling Stripe Webhooks Using Django Signals in dj-stripe</h2>
<p>dj-stripe integrates with Django&#x27;s signals framework to provide a robust mechanism for handling Stripe webhook events. This approach allows developers to react to Stripe events by executing custom logic linked to signal receivers. This document guides you through setting up and using Django signals with dj-stripe to handle various Stripe webhook events efficiently.</p>
<h3>Configuring Webhook Endpoints</h3>
<p>Before you can handle webhook events, ensure you&#x27;ve configured your webhook endpoints correctly in Stripe and dj-stripe. This can typically be done from the Django admin panel under dj-stripe -&gt; Webhook endpoints.</p>
<h3>Event Processing Flow</h3>
<ol>
<li><strong>Receiving Events</strong>: When Stripe sends a webhook event, dj-stripe receives the data and creates an <code>Event</code> object in your Django database.</li>
<li><strong>Emitting Signals</strong>: After storing the event, dj-stripe emits a Django signal corresponding to the event type (e.g., <code>charge.succeeded</code>, <code>payment_method.attached</code>).</li>
<li><strong>Database Operations by dj-stripe</strong>: dj-stripe also listens to these signals to perform CRUD operations on corresponding Django models, such as <code>Charge</code> or <code>PaymentMethod</code>. This ensures that your database stays in sync with the Stripe data.</li>
<li><strong>Handling Events</strong>: You can handle these signals with custom functions linked via the <code>djstripe_receiver</code> decorator.</li>
</ol>
<h3>Implementing Custom Event Handlers</h3>
<p>To create custom handlers for Stripe webhook events, follow these steps:</p>
<h4>1. Set Up Signal Handlers</h4>
<p>First, import the necessary modules and decorators from dj-stripe and define functions to handle the events of interest.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> djstripe.event_handlers <span class="hljs-keyword">import</span> djstripe_receiver
<span class="hljs-keyword">from</span> djstripe.models <span class="hljs-keyword">import</span> Event, Charge, PaymentMethod

<span class="hljs-meta">@djstripe_receiver(<span class="hljs-params"><span class="hljs-string">&quot;charge.succeeded&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_charge_succeeded</span>(<span class="hljs-params">sender, **kwargs</span>):
    event: Event = kwargs.get(<span class="hljs-string">&quot;event&quot;</span>)
    charge_id = event.data[<span class="hljs-string">&quot;object&quot;</span>][<span class="hljs-string">&quot;id&quot;</span>]
    charge = Charge.objects.get(<span class="hljs-built_in">id</span>=charge_id)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Charge succeeded!&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Sender: <span class="hljs-subst">{sender}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Event: <span class="hljs-subst">{event}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Charge: <span class="hljs-subst">{charge}</span>&quot;</span>)

<span class="hljs-meta">@djstripe_receiver(<span class="hljs-params"><span class="hljs-string">&quot;payment_method.attached&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_payment_method_attached</span>(<span class="hljs-params">sender, **kwargs</span>):
    event: Event = kwargs.get(<span class="hljs-string">&quot;event&quot;</span>)
    payment_method_id = event.data[<span class="hljs-string">&quot;object&quot;</span>][<span class="hljs-string">&quot;id&quot;</span>]
    payment_method = PaymentMethod.objects.get(<span class="hljs-built_in">id</span>=payment_method_id)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Payment Method Attached!&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Sender: <span class="hljs-subst">{sender}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Event: <span class="hljs-subst">{event}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Payment Method: <span class="hljs-subst">{payment_method}</span>&quot;</span>)
</code></pre>
<h4>2. Ensure Proper Loading of Handlers</h4>
<p>Ensure that your custom signal handlers are loaded at the appropriate time by including their module in your application&#x27;s startup sequence. Typically, this can be handled in the <code>apps.py</code> of your Django application by overriding the <code>ready()</code> method.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> django.apps <span class="hljs-keyword">import</span> AppConfig

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAppConfig</span>(<span class="hljs-title class_ inherited__">AppConfig</span>):
    name = <span class="hljs-string">&#x27;my_app&#x27;</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ready</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">import</span> my_app.signals  <span class="hljs-comment"># ensure your signals are imported</span>
</code></pre>
<h2>Official documentation</h2>
<p>Stripe docs for types of Events:
<a href="https://stripe.com/docs/api/events/types">https://stripe.com/docs/api/events/types</a></p>
<p>Stripe docs for Webhooks: <a href="https://stripe.com/docs/webhooks">https://stripe.com/docs/webhooks</a></p>
<p>Django docs for transactions:
<a href="https://docs.djangoproject.com/en/dev/topics/db/transactions/#performing-actions-after-commit">https://docs.djangoproject.com/en/dev/topics/db/transactions/#performing-actions-after-commit</a></p></article></main></div></div></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-08309892bbe354a2.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1483,[\"177\",\"static/chunks/app/layout-e2df609ea3d3ba96.js\"],\"ThemeProvider\"]\n3:I[7555,[],\"\"]\n4:I[1295,[],\"\"]\n6:I[9665,[],\"OutletBoundary\"]\n8:I[4911,[],\"AsyncMetadataOutlet\"]\na:I[9665,[],\"ViewportBoundary\"]\nc:I[9665,[],\"MetadataBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[8393,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/2ff57a8dc1dd022b.css\",\"style\"]\n:HL[\"/_next/static/css/ce02c38972971c8a.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Lt0K8WUACoDZQxw3pAg8v\",\"p\":\"\",\"c\":[\"\",\"docs\",\"dev\",\"usage\",\"webhooks\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"version\",\"dev\",\"d\"],{\"children\":[[\"slug\",\"usage/webhooks\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2ff57a8dc1dd022b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ce02c38972971c8a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[\"$\",\"$L2\",null,{\"defaultTheme\":\"system\",\"storageKey\":\"dj-stripe-theme\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}],{\"children\":[\"docs\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"version\",\"dev\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"usage/webhooks\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"promise\":\"$@9\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$d\",null,{\"fallback\":null,\"children\":\"$Le\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"9:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"dj-stripe - Stripe Made Easy for Django Developers\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"The easiest way to integrate Stripe with your Django project. Handle payments, subscriptions, and webhooks with just a few lines of code.\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"e:\"$9:metadata\"\n"])</script><script>self.__next_f.push([1,"10:I[6105,[\"244\",\"static/chunks/244-75f77586f1edfee3.js\",\"105\",\"static/chunks/105-9c71a7be9e3657b0.js\",\"967\",\"static/chunks/app/docs/%5Bversion%5D/%5B%5B...slug%5D%5D/page-3887ad97704d0fd7.js\"],\"Navigation\"]\n11:I[6690,[\"244\",\"static/chunks/244-75f77586f1edfee3.js\",\"105\",\"static/chunks/105-9c71a7be9e3657b0.js\",\"967\",\"static/chunks/app/docs/%5Bversion%5D/%5B%5B...slug%5D%5D/page-3887ad97704d0fd7.js\"],\"VersionSelector\"]\n12:I[6874,[\"244\",\"static/chunks/244-75f77586f1edfee3.js\",\"105\",\"static/chunks/105-9c71a7be9e3657b0.js\",\"967\",\"static/chunks/app/docs/%5Bversion%5D/%5B%5B...slug%5D%5D/page-3887ad97704d0fd7.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-white dark:bg-gray-900\",\"children\":[[\"$\",\"$L10\",null,{\"className\":\"sticky top-0 bg-white dark:bg-gray-900 z-10\",\"children\":[\"$\",\"$L11\",null,{\"currentVersion\":\"dev\",\"versions\":[\"dev\"],\"currentPath\":\"usage/webhooks\"}]}],[\"$\",\"div\",null,{\"className\":\"container mx-auto px-6 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex gap-8\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"w-64 flex-shrink-0\",\"children\":[\"$\",\"nav\",null,{\"className\":\"sticky top-24\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"font-semibold mb-4\",\"children\":\"Documentation\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-2\",\"children\":[[\"$\",\"li\",\"\",{\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/docs/dev\",\"className\":\"block px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors \",\"children\":\"Getting Started\"}],[\"$\",\"ul\",null,{\"className\":\"ml-4 mt-2 space-y-1\",\"children\":[[\"$\",\"li\",\"/installation\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/installation\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"Installation\"}]}],[\"$\",\"li\",\"/api_keys\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/api_keys\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"API Keys\"}]}],[\"$\",\"li\",\"/api_versions\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/api_versions\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"API Versions\"}]}],[\"$\",\"li\",\"/upgrade_dj_stripe\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/upgrade_dj_stripe\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"Upgrade Guide\"}]}]]}]]}],[\"$\",\"li\",\"/usage\",{\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/usage\",\"className\":\"block px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors \",\"children\":\"Usage\"}],[\"$\",\"ul\",null,{\"className\":\"ml-4 mt-2 space-y-1\",\"children\":[[\"$\",\"li\",\"/usage/webhooks\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/usage/webhooks\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors bg-blue-50 dark:bg-blue-900/20 text-blue-600\",\"children\":\"Webhooks\"}]}],[\"$\",\"li\",\"/usage/subscribing_customers\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/usage/subscribing_customers\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"Subscribing Customers\"}]}],[\"$\",\"li\",\"/usage/add_payment_method_to_customer\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/usage/add_payment_method_to_customer\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"Payment Methods\"}]}],[\"$\",\"li\",\"/usage/managing_subscriptions\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/usage/managing_subscriptions\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"Managing Subscriptions\"}]}],[\"$\",\"li\",\"/usage/using_stripe_checkout\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/usage/using_stripe_checkout\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"Stripe Checkout\"}]}],[\"$\",\"li\",\"/usage/manually_syncing_with_stripe\",{\"children\":[\"$\",\"$L12\",null,{\"href\":\"/docs/dev/usage/manually_syncing_with_stripe\",\"className\":\"block px-3 py-1 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400\",\"children\":\"Manual Syncing\"}]}]]}]]}]]}]]}]}],[\"$\",\"main\",null,{\"className\":\"flex-1 max-w-4xl\",\"children\":\"$L13\"}]]}]}]]}]\n"])</script><script>self.__next_f.push([1,"13:[\"$\",\"article\",null,{\"className\":\"prose prose-lg max-w-none\",\"children\":\"$L14\"}]\n"])</script><script>self.__next_f.push([1,"14:[[\"$\",\"h1\",null,{\"children\":\"Using Stripe Webhooks\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Setting up a new webhook endpoint in dj-stripe\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As of dj-stripe 2.7.0, dj-stripe can create its own webhook endpoints on Stripe from the\\nDjango administration.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Create a new webhook endpoint from the Django administration by going to dj-stripe\\n-\u003e Webhook endpoints -\u003e Add webhook endpoint (or \",[\"$\",\"code\",null,{\"children\":\"/admin/djstripe/webhookendpoint/add/\"}],\").\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"From there, you can choose an account to create the endpoint for.\\nIf no account is chosen, the default Stripe API key will be used to create the endpoint.\\nYou can also choose to create the endpoint in test mode or live mode.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You may want to change the base URL of the endpoint. This field will be prefilled with\\nthe current site. If you're running on the local development server, you may see\\n\",[\"$\",\"code\",null,{\"children\":\"http://localhost:8000\"}],\" or similar in there. Stripe won't let you save webhook endpoints\\nwith such a value, so you will want to change it to a real website URL.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When saved from the admin, the endpoint will be created in Stripe with a dj-stripe\\nspecific UUID which will be part of the URL, making it impossible to guess externally\\nby brute-force.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Extra configuration\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"dj-stripe provides the following settings to tune how your webhooks work:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[\",[\"$\",\"code\",null,{\"children\":\"DJSTRIPE_WEBHOOK_VALIDATION\"}],\"][djstripe.settings.DjstripeSettings.WEBHOOK_VALIDATION]\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[\",[\"$\",\"code\",null,{\"children\":\"DJSTRIPE_WEBHOOK_EVENT_CALLBACK\"}],\"][djstripe.settings.DjstripeSettings.WEBHOOK_EVENT_CALLBACK]\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Handling Stripe Webhooks Using Django Signals in dj-stripe\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"dj-stripe integrates with Django's signals framework to provide a robust mechanism for handling Stripe webhook events. This approach allows developers to react to Stripe events by executing custom logic linked to signal receivers. This document guides you through setting up and using Django signals with dj-stripe to handle various Stripe webhook events efficiently.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Configuring Webhook Endpoints\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Before you can handle webhook events, ensure you've configured your webhook endpoints correctly in Stripe and dj-stripe. This can typically be done from the Django admin panel under dj-stripe -\u003e Webhook endpoints.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Event Processing Flow\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Receiving Events\"}],\": When Stripe sends a webhook event, dj-stripe receives the data and creates an \",[\"$\",\"code\",null,{\"children\":\"Event\"}],\" object in your Django database.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Emitting Signals\"}],\": After storing the event, dj-stripe emits a Django signal corresponding to the event type (e.g., \",[\"$\",\"code\",null,{\"children\":\"charge.succeeded\"}],\", \",[\"$\",\"code\",null,{\"children\":\"payment_method.attached\"}],\").\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Database Operations by dj-stripe\"}],\": dj-stripe also listens to these signals to perform CRUD operations on corresponding Django models, such as \",[\"$\",\"code\",null,{\"children\":\"Charge\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"PaymentMethod\"}],\". This ensures that your database stays in sync with the Stripe data.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Handling Events\"}],\": You can handle these signals with custom functions linked via the \",\"$L15\",\" decorator.\"]}],\"\\n\"]}],\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\"]\n"])</script><script>self.__next_f.push([1,"15:[\"$\",\"code\",null,{\"children\":\"djstripe_receiver\"}]\n16:[\"$\",\"h3\",null,{\"children\":\"Implementing Custom Event Handlers\"}]\n17:[\"$\",\"p\",null,{\"children\":\"To create custom handlers for Stripe webhook events, follow these steps:\"}]\n18:[\"$\",\"h4\",null,{\"children\":\"1. Set Up Signal Handlers\"}]\n19:[\"$\",\"p\",null,{\"children\":\"First, import the necessary modules and decorators from dj-stripe and define functions to handle the events of interest.\"}]\n"])</script><script>self.__next_f.push([1,"1a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-python\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" djstripe.event_handlers \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" djstripe_receiver\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" djstripe.models \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" Event, Charge, PaymentMethod\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-meta\",\"children\":[\"@djstripe_receiver(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"charge.succeeded\\\"\"}]}],\")\"]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"handle_charge_succeeded\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"sender, **kwargs\"}],\"):\\n    event: Event = kwargs.get(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"event\\\"\"}],\")\\n    charge_id = event.data[\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"object\\\"\"}],\"][\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"id\\\"\"}],\"]\\n    charge = Charge.objects.get(\",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"id\"}],\"=charge_id)\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Charge succeeded!\\\"\"}],\")\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"f\\\"Sender: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"{sender}\"}],\"\\\"\"]}],\")\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"f\\\"Event: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"{event}\"}],\"\\\"\"]}],\")\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"f\\\"Charge: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"{charge}\"}],\"\\\"\"]}],\")\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-meta\",\"children\":[\"@djstripe_receiver(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"payment_method.attached\\\"\"}]}],\")\"]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"handle_payment_method_attached\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"sender, **kwargs\"}],\"):\\n    event: Event = kwargs.get(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"event\\\"\"}],\")\\n    payment_method_id = event.data[\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"object\\\"\"}],\"][\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"id\\\"\"}],\"]\\n    payment_method = PaymentMethod.objects.get(\",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"id\"}],\"=payment_method_id)\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Payment Method Attached!\\\"\"}],\")\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"f\\\"Sender: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"{sender}\"}],\"\\\"\"]}],\")\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"f\\\"Event: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"{event}\"}],\"\\\"\"]}],\")\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"print\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"f\\\"Payment Method: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"{payment_method}\"}],\"\\\"\"]}],\")\\n\"]}]}]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"h4\",null,{\"children\":\"2. Ensure Proper Loading of Handlers\"}]\n1c:[\"$\",\"p\",null,{\"children\":[\"Ensure that your custom signal handlers are loaded at the appropriate time by including their module in your application's startup sequence. Typically, this can be handled in the \",[\"$\",\"code\",null,{\"children\":\"apps.py\"}],\" of your Django application by overriding the \",[\"$\",\"code\",null,{\"children\":\"ready()\"}],\" method.\"]}]\n"])</script><script>self.__next_f.push([1,"1d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-python\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" django.apps \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" AppConfig\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyAppConfig\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_ inherited__\",\"children\":\"AppConfig\"}],\"):\\n    name = \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'my_app'\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"ready\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"self\"}],\"):\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" my_app.signals  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"# ensure your signals are imported\"}],\"\\n\"]}]}]\n"])</script><script>self.__next_f.push([1,"1e:[\"$\",\"h2\",null,{\"children\":\"Official documentation\"}]\n1f:[\"$\",\"p\",null,{\"children\":[\"Stripe docs for types of Events:\\n\",[\"$\",\"a\",null,{\"href\":\"https://stripe.com/docs/api/events/types\",\"children\":\"https://stripe.com/docs/api/events/types\"}]]}]\n20:[\"$\",\"p\",null,{\"children\":[\"Stripe docs for Webhooks: \",[\"$\",\"a\",null,{\"href\":\"https://stripe.com/docs/webhooks\",\"children\":\"https://stripe.com/docs/webhooks\"}]]}]\n21:[\"$\",\"p\",null,{\"children\":[\"Django docs for transactions:\\n\",[\"$\",\"a\",null,{\"href\":\"https://docs.djangoproject.com/en/dev/topics/db/transactions/#performing-actions-after-commit\",\"children\":\"https://docs.djangoproject.com/en/dev/topics/db/transactions/#performing-actions-after-commit\"}]]}]\n"])</script></body></html>